<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Maze for Nolan's Final Project</title>
    <style>
        body {
            background-color: black;
            overflow: hidden;
            margin: 0;
        }
        .game-object {
            position: absolute;
        }
        /* New obstacle styles for clear distinction */
        .blue-obstacle {
            background-color: blue;
            width: 32px; /* Same size as player for easy collision */
            height: 32px;
            position: absolute;
        }
        .orange-obstacle {
            background-color: orange;
            width: 32px;
            height: 32px;
            position: absolute;
        }
    </style>
</head>
<body id="myBody">

<h1 style="text-align: center; color: red;">Dynamic Maze Challenge</h1>

<img id="myPlayer" src="myPlayer.png" class="game-object" style="width:32px; height:32px; left: 50px; top:190px;">
<img id="myWinArea" src="myWinArea.gif" class="game-object" style="width:100px; height:80px; left: 880px; top: 100px;">

<div id="blueObstacle" class="blue-obstacle game-object" style="left: 300px; top: 120px;"></div>
<div id="orangeObstacle" class="orange-obstacle game-object" style="left: 600px; top: 400px;"></div>

<img id="wall-top" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 50px;">
<img id="wall-bottom" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 550px;">
<img id="wall-left" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 0px; top: 50px;">
<img id="wall-right" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 990px; top: 50px;">

<img id="wall-a1" src="blockImage.png" class="game-object" style="width:10px; height:100px; left: 150px; top: 50px;">
<img id="wall-a2" src="blockImage.png" class="game-object" style="width:10px; height:200px; left: 150px; top: 350px;">
<img id="wall-a3" src="blockImage.png" class="game-object" style="width:150px; height:10px; left: 150px; top: 350px;">

<img id="wall-b1" src="blockImage.png" class="game-object" style="width:300px; height:10px; left: 160px; top: 250px;">
<img id="wall-b2" src="blockImage.png" class="game-object" style="width:10px; height:100px; left: 450px; top: 50px;">

<img id="wall-c1" src="blockImage.png" class="game-object" style="width:10px; height:200px; left: 550px; top: 250px;">
<img id="wall-c2" src="blockImage.png" class="game-object" style="width:150px; height:10px; left: 450px; top: 400px;">

<img id="wall-d1" src="blockImage.png" class="game-object" style="width:10px; height:100px; left: 700px; top: 50px;">
<img id="wall-d2" src="blockImage.png" class="game-object" style="width:300px; height:10px; left: 550px; top: 500px;">
<img id="wall-d3" src="blockImage.png" class="game-object" style="width:10px; height:150px; left: 700px; top: 350px;">

<img id="wall-e1" src="blockImage.png" class="game-object" style="width:100px; height:10px; left: 790px; top: 150px;">


<script>
// --- 1. Variable Initialization ---
const myPlayer = document.getElementById("myPlayer");
const blueObstacle = document.getElementById("blueObstacle");
const orangeObstacle = document.getElementById("orangeObstacle");
const playerWidth = 32;
const playerHeight = 32;

let playerX = parseInt(myPlayer.style.left) || 0;
let playerY = parseInt(myPlayer.style.top) || 0;
let prevPlayerX = playerX; 
let prevPlayerY = playerY; 
let maxPlayerX = 0;
let maxPlayerY = 0;

let up = false;
let left = false;
let down = false;
let right = false;

// Obstacle movement state
let blueDirection = 1; // 1 for right, -1 for left
let orangeDirection = 1; // 1 for down, -1 for up

const mazeWalls = [
    'wall-top', 'wall-bottom', 'wall-left', 'wall-right',
    'wall-a1', 'wall-a2', 'wall-a3',
    'wall-b1', 'wall-b2',
    'wall-c1', 'wall-c2',
    'wall-d1', 'wall-d2', 'wall-d3',
    'wall-e1'
];

// --- 2. Boundary Management ---
function updateBoundaries(){
    maxPlayerX = window.innerWidth - playerWidth;
    maxPlayerY = window.innerHeight - playerHeight;
}

updateBoundaries(); 
window.addEventListener('resize', updateBoundaries);

// --- 3. Collision Function ---
function myHitOther(my1, my2){
    const element1 = document.getElementById(my1);
    const element2 = document.getElementById(my2);

    if (!element1 || !element2) {
        return false;
    }
    
    // Get numeric coordinates
    let left1   = parseInt(element1.style.left);
    let right1  = left1 + parseInt(element1.style.width);
    let top1    = parseInt(element1.style.top);    
    let bottom1 = top1    + parseInt(element1.style.height);
    
    let left2   = parseInt(element2.style.left);
    let right2  = left2 + parseInt(element2.style.width);
    let top2    = parseInt(element2.style.top);    
    let bottom2 = top2    + parseInt(element2.style.height);
    
    // Standard AABB collision check
    if ((right1  >=  left2  ) &&           
        (bottom1 >=  top2   ) &&
        (left1   <=  right2 ) &&
        (top1    <=  bottom2) ){
        return true;
    }
    return false;
}

// --- 4. Input Handlers (Unchanged) ---
document.onkeydown = function(event){
   if (event.key === "w"){up = true;}
   if (event.key === "s"){down = true;}
   if (event.key === "a"){left = true;}
   if (event.key === "d"){right = true;}
}

document.onkeyup = function(event){
   if (event.key === "w"){up = false;}
   if (event.key === "s"){down = false;}
   if (event.key === "a"){left = false;}
   if (event.key === "d"){right = false;}
}

// --- NEW: Obstacle Movement Logic ---

function obstacleMovement() {
    // 1. Blue Obstacle (Horizontal, between X=250 and X=500)
    let blueX = parseInt(blueObstacle.style.left);
    blueX += 2 * blueDirection;
    
    if (blueX > 500) { blueDirection = -1; }
    if (blueX < 250) { blueDirection = 1; }
    
    blueObstacle.style.left = blueX + 'px';

    // 2. Orange Obstacle (Vertical, between Y=100 and Y=450)
    let orangeY = parseInt(orangeObstacle.style.top);
    orangeY += 2 * orangeDirection;

    if (orangeY > 450) { orangeDirection = -1; }
    if (orangeY < 100) { orangeDirection = 1; }
    
    orangeObstacle.style.top = orangeY + 'px';
}


// --- NEW: Obstacle Collision Checks ---

function checkHitBlue(){
    // BLUE: Must stop moving! Check if player is attempting to move (any key pressed)
    if (myHitOther('myPlayer', 'blueObstacle')) {
        if (up || down || left || right) {
            // Player is hit AND is moving -> Game Over (teleport to start)
            playerX = 50; 
            playerY = 190;
            myPlayer.style.left = playerX + 'px';
            myPlayer.style.top = playerY + 'px';
            return true;
        }
    }
    return false;
}

function checkHitOrange(){
    // ORANGE: Must keep moving! Check if player is NOT attempting to move
    if (myHitOther('myPlayer', 'orangeObstacle')) {
        if (!up && !down && !left && !right) {
            // Player is hit AND is stationary -> Game Over (teleport to start)
            playerX = 50; 
            playerY = 190;
            myPlayer.style.left = playerX + 'px';
            myPlayer.style.top = playerY + 'px';
            return true;
        }
    }
    return false;
}


// --- Collision Checks for Sliding (Unchanged from last fix) ---
function checkHitWallX(){
    for (const wallId of mazeWalls) {
        if (myHitOther('myPlayer', wallId)) {
            playerX = prevPlayerX; 
            myPlayer.style.left = playerX + 'px';
            return; 
        }
    }
}

function checkHitWallY(){
    for (const wallId of mazeWalls) {
        if (myHitOther('myPlayer', wallId)) {
            playerY = prevPlayerY; 
            myPlayer.style.top = playerY + 'px';
            return; 
        }
    }
}

// --- 5. Game Loop and Movement ---
function movement(){
    // 1. Check Obstacles FIRST (They will teleport the player if the rule is broken)
    if (checkHitBlue() || checkHitOrange()) {
        // If an obstacle hit caused a teleport, stop the rest of the movement frame
        return; 
    }
    
    // Store safe position before attempting move
    prevPlayerX = playerX;
    prevPlayerY = playerY;

    // 2. Player Movement and Wall Collision (X-axis)
    if (left) { playerX -= 3}
    if (right) { playerX += 3}
    
    if (playerX < 0){playerX = 0}
    if (playerX > maxPlayerX){playerX = maxPlayerX}
    myPlayer.style.left = playerX + 'px';
    checkHitWallX();

    // 3. Player Movement and Wall Collision (Y-axis)
    if (up) { playerY -= 3}
    if (down) { playerY += 3}

    if (playerY < 0){playerY = 0}
    if (playerY > maxPlayerY){playerY = maxPlayerY}
    myPlayer.style.top = playerY + 'px';
    checkHitWallY();
    
    // 4. Check Win Condition
    if ( myHitOther('myPlayer','myWinArea') ){
        location.href = 'https://nolan-b-mss.github.io/personal-use-nolan/public/undertale-test-05.html';
    }
}

// Start game and obstacle loops
setInterval(movement, 10);
setInterval(obstacleMovement, 10);
</script>

</body>
</html>
