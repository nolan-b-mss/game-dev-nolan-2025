<!DOCTYPE html>
<html>
<head>
    <title>Dynamic Maze Final Challenge - FIXED PUNISHMENT</title>
    <style>
        body {
            background-color: black;
            overflow: hidden;
            margin: 0;
        }
        .game-object {
            position: absolute;
        }
        .blue-obstacle {
            background-color: blue;
            width: 30px; 
            height: 500px; 
            position: absolute;
            top: 50px; 
        }
        .orange-obstacle {
            background-color: orange;
            width: 30px;
            height: 500px; 
            position: absolute;
            top: 50px; 
        }
    </style>
</head>
<body id="myBody">

<h1 style="text-align: center; color: red;">Dynamic Maze Final Challenge</h1>

<img id="myPlayer" src="myPlayer.png" class="game-object" style="width:32px; height:32px; left: 100px; top:450px;">
<img id="myWinArea" src="myWinArea.gif" class="game-object" style="width:100px; height:100px; left: 880px; top: 80px;">

<div id="blueObstacle" class="blue-obstacle game-object" style="left: 300px;"></div>
<div id="orangeObstacle" class="orange-obstacle game-object" style="left: 650px;"></div>

<img id="wall-top" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 50px;">
<img id="wall-bottom" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 550px;">
<img id="wall-left" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 0px; top: 50px;">
<img id="wall-right" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 990px; top: 50px;">
<img id="wall-v1" src="blockImage.png" class="game-object" style="width:10px; height:300px; left: 200px; top: 50px;">
<img id="wall-v2" src="blockImage.png" class="game-object" style="width:10px; height:200px; left: 450px; top: 350px;">
<img id="wall-v3" src="blockImage.png" class="game-object" style="width:10px; height:200px; left: 800px; top: 350px;">
<img id="wall-v4" src="blockImage.png" class="game-object" style="width:10px; height:100px; left: 550px; top: 50px;">
<img id="wall-h1" src="blockImage.png" class="game-object" style="width:200px; height:10px; left: 200px; top: 350px;">
<img id="wall-h2" src="blockImage.png" class="game-object" style="width:100px; height:10px; left: 550px; top: 150px;">
<img id="wall-h3" src="blockImage.png" class="game-object" style="width:100px; height:10px; left: 800px; top: 350px;">
<img id="wall-h4" src="blockImage.png" class="game-object" style="width:150px; height:10px; left: 450px; top: 450px;">
<img id="wall-h5" src="blockImage.png" class="game-object" style="width:150px; height:10px; left: 700px; top: 250px;">

<script>
// --- 1. Variable Initialization ---
const myPlayer = document.getElementById("myPlayer");
const blueObstacle = document.getElementById("blueObstacle");
const orangeObstacle = document.getElementById("orangeObstacle");
const playerWidth = 32;
const playerHeight = 32;

const START_X = 100;
const START_Y = 450;

let playerX = START_X;
let playerY = START_Y;
let prevPlayerX = playerX; 
let prevPlayerY = playerY; 
let maxPlayerX = 0;
let maxPlayerY = 0;

let up = false;
let left = false;
let down = false;
let right = false;

let blueDirection = 1; 

const mazeWalls = [
    'wall-top', 'wall-bottom', 'wall-left', 'wall-right',
    'wall-v1', 'wall-v2', 'wall-v3', 'wall-v4',
    'wall-h1', 'wall-h2', 'wall-h3', 'wall-h4', 'wall-h5'
];

// --- 2. Boundary Management & Collision Function (Unchanged) ---
function updateBoundaries(){
    maxPlayerX = window.innerWidth - playerWidth;
    maxPlayerY = window.innerHeight - playerHeight;
}
updateBoundaries(); 
window.addEventListener('resize', updateBoundaries);

function myHitOther(my1, my2){
    const element1 = document.getElementById(my1);
    const element2 = document.getElementById(my2);
    if (!element1 || !element2) {
        return false;
    }
    
    let left1   = parseInt(element1.style.left);
    let right1  = left1 + parseInt(element1.style.width);
    let top1    = parseInt(element1.style.top);    
    let bottom1 = top1    + parseInt(element1.style.height);
    
    let left2   = parseInt(element2.style.left);
    let right2  = left2 + parseInt(element2.style.width);
    let top2    = parseInt(element2.style.top);    
    let bottom2 = top2    + parseInt(element2.style.height);
    
    if ((right1  >=  left2  ) && (bottom1 >=  top2   ) &&
        (left1   <=  right2 ) && (top1    <=  bottom2) ){
        return true;
    }
    return false;
}

// --- NEW HELPER FUNCTION: Teleport Player to Start ---
function resetPlayer() {
    // Reset internal variables
    playerX = START_X; 
    playerY = START_Y;
    prevPlayerX = START_X; 
    prevPlayerY = START_Y; 
    
    // Update style immediately
    myPlayer.style.left = playerX + 'px';
    myPlayer.style.top = playerY + 'px';

    // Optional: brief visual flash for confirmation
    myPlayer.style.opacity = 0.5;
    setTimeout(() => {
        myPlayer.style.opacity = 1;
    }, 100);
}


// --- Obstacle Movement Logic (Unchanged) ---
function obstacleMovement() {
    let blueX = parseInt(blueObstacle.style.left);
    blueX += 2 * blueDirection;
    if (blueX > 500) { blueDirection = -1; }
    if (blueX < 250) { blueDirection = 1; }
    blueObstacle.style.left = blueX + 'px';
}

// --- Obstacle Collision Checks (Now uses resetPlayer helper) ---

function checkHitBlue(){
    if (myHitOther('myPlayer', 'blueObstacle')) {
        if (up || down || left || right) {
            resetPlayer(); // Teleport
            return true;
        }
    }
    return false;
}

function checkHitOrange(){
    if (myHitOther('myPlayer', 'orangeObstacle')) {
        if (!up && !down && !left && !right) {
            resetPlayer(); // Teleport
            return true;
        }
    }
    return false;
}


// --- Wall Collision Checks (Unchanged) ---
function checkHitWallX(){
    for (const wallId of mazeWalls) {
        if (myHitOther('myPlayer', wallId)) {
            playerX = prevPlayerX; 
            myPlayer.style.left = playerX + 'px';
            return; 
        }
    }
}

function checkHitWallY(){
    for (const wallId of mazeWalls) {
        if (myHitOther('myPlayer', wallId)) {
            playerY = prevPlayerY; 
            myPlayer.style.top = playerY + 'px';
            return; 
        }
    }
}

// --- 5. Game Loop and Movement ---
function movement(){
    // 1. CRITICAL: Check Obstacles FIRST. If a reset occurs, RETURN immediately.
    if (checkHitBlue() || checkHitOrange()) {
        return; 
    }
    
    // Store safe position before attempting move
    prevPlayerX = playerX;
    prevPlayerY = playerY;

    // 2. Player Movement and Wall Collision (X-axis)
    if (left) { playerX -= 3}
    if (right) { playerX += 3}
    
    if (playerX < 0){playerX = 0}
    if (playerX > maxPlayerX){playerX = maxPlayerX}
    myPlayer.style.left = playerX + 'px';
    checkHitWallX();

    // 3. Player Movement and Wall Collision (Y-axis)
    if (up) { playerY -= 3}
    if (down) { playerY += 3}

    if (playerY < 0){playerY = 0}
    if (playerY > maxPlayerY){playerY = maxPlayerY}
    myPlayer.style.top = playerY + 'px';
    checkHitWallY();
    
    // 4. Check Win Condition
    if ( myHitOther('myPlayer','myWinArea') ){
        location.href = 'https://nolan-b-mss.github.io/personal-use-nolan/public/undertale-test-05.html';
    }
}

// Start game and obstacle loops
setInterval(movement, 10);
setInterval(obstacleMovement, 10);
</script>

</body>
</html>
