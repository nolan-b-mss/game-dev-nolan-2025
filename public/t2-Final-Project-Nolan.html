<!DOCTYPE html>
<html>
<head>
    <title>Maze Tutorial for Nolan's Final Project</title>
    <style>
        body {
            background-color: black;
            overflow: hidden;
            margin: 0;
        }
        .game-object {
            position: absolute;
        }
    </style>
</head>
<body id="myBody">

<h1 style="text-align: center; color: red;">Maze Tutorial for Nolan's Final Project</h1>

<img id="myPlayer" src="myPlayer.png" class="game-object" style="width:32px; height:32px; left: 50px; top:190px;">
<img id="myWinArea" src="myWinArea.gif" class="game-object" style="width:100px; height:80px; left: 880px; top: 100px;">

<img id="wall-top" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 50px;">
<img id="wall-bottom" src="blockImage.png" class="game-object" style="width:1000px; height:10px; left: 0px; top: 550px;">
<img id="wall-left" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 0px; top: 50px;">
<img id="wall-right" src="blockImage.png" class="game-object" style="width:10px; height:500px; left: 990px; top: 50px;">
<img id="wall-v01" src="blockImage.png" class="game-object" style="width:10px; height:200px; left: 200px; top: 50px;">
<img id="wall-v02" src="blockImage.png" class="game-object" style="width:10px; height:300px; left: 400px; top: 250px;">
<img id="wall-v03" src="blockImage.png" class="game-object" style="width:10px; height:150px; left: 600px; top: 50px;">
<img id="wall-v04" src="blockImage.png" class="game-object" style="width:10px; height:150px; left: 800px; top: 300px;">
<img id="wall-h01" src="blockImage.png" class="game-object" style="width:300px; height:10px; left: 100px; top: 350px;">
<img id="wall-h02" src="blockImage.png" class="game-object" style="width:400px; height:10px; left: 600px; top: 200px;">
<img id="wall-h03" src="blockImage.png" class="game-object" style="width:200px; height:10px; left: 400px; top: 450px;">
<script>
// --- 1. Variable Initialization ---
const myPlayer = document.getElementById("myPlayer");
const playerWidth = 32;
const playerHeight = 32;
let playerX = parseInt(myPlayer.style.left) || 0;
let playerY = parseInt(myPlayer.style.top) || 0;
let prevPlayerX = playerX; // NEW: Store last safe X
let prevPlayerY = playerY; // NEW: Store last safe Y
let maxPlayerX = 0;
let maxPlayerY = 0;
let up = false;
let left = false;
let down = false;
let right = false;

const mazeWalls = [
    'wall-top', 'wall-bottom', 'wall-left', 'wall-right',
    'wall-v01', 'wall-v02', 'wall-v03', 'wall-v04',
    'wall-h01', 'wall-h02', 'wall-h03'
];

// --- 2. Boundary Management ---
function updateBoundaries(){
    maxPlayerX = window.innerWidth - playerWidth;
    maxPlayerY = window.innerHeight - playerHeight;
}

updateBoundaries(); 
window.addEventListener('resize', updateBoundaries);

// --- 3. Collision Function ---
function myHitOther(my1, my2){
    const element1 = document.getElementById(my1);
    const element2 = document.getElementById(my2);

    if (!element1 || !element2) {
        return false;
    }
    
    let left1   = parseInt(element1.style.left);
    let right1  = left1 + parseInt(element1.style.width);
    let top1    = parseInt(element1.style.top);    
    let bottom1 = top1    + parseInt(element1.style.height);
    
    let left2   = parseInt(element2.style.left);
    let right2  = left2 + parseInt(element2.style.width);
    let top2    = parseInt(element2.style.top);    
    let bottom2 = top2    + parseInt(element2.style.height);
    
    if ((right1  >=  left2  ) &&           
        (bottom1 >=  top2   ) &&
        (left1   <=  right2 ) &&
        (top1    <=  bottom2) ){
        return true;
    }
    return false;
}

// --- 4. Input Handlers ---
document.onkeydown = function(event){
   if (event.key === "w"){up = true;}
   if (event.key === "s"){down = true;}
   if (event.key === "a"){left = true;}
   if (event.key === "d"){right = true;}
}

document.onkeyup = function(event){
   if (event.key === "w"){up = false;}
   if (event.key === "s"){down = false;}
   if (event.key === "a"){left = false;}
   if (event.key === "d"){right = false;}
}

// --- 5. Game Loop and Movement ---
function movement(){
    // FIX: Store the current (safe) position before attempting a move
    prevPlayerX = playerX;
    prevPlayerY = playerY;
    
    if (up) { playerY -= 3}
    if (down) { playerY += 3}
    if (left) { playerX -= 3}
    if (right) { playerX += 3}
    
    if (playerX < 0){playerX = 0}
    if (playerY < 0){playerY = 0}
    
    if (playerX > maxPlayerX){playerX = maxPlayerX}
    if (playerY > maxPlayerY){playerY = maxPlayerY}

    myPlayer.style.top = playerY + 'px';
    myPlayer.style.left = playerX + 'px';
    myCheckHit();
}

setInterval(movement, 10);

// --- 6. Collision Response ---
function myCheckHit(){

    // Check collision with any wall
    for (const wallId of mazeWalls) {
        if (myHitOther('myPlayer', wallId)) {
            // FIX: Revert player to the last safe position (prevents sticky wall effect)
            playerX = prevPlayerX; 
            playerY = prevPlayerY;
            myPlayer.style.left = playerX + 'px';
            myPlayer.style.top = playerY + 'px';
            return; // Stop checking after the first hit
        }
    }
    
    // Check win condition
    if ( myHitOther('myPlayer','myWinArea') ){
        location.href = 'https://nolan-b-mss.github.io/personal-use-nolan/public/undertale-test-05.html';
    }
}
</script>

</body>
</html>
